<!DOCTYPE html>
<html>

<head><meta name="generator" content="Hexo 3.8.0">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Von Weber&#39;s Blog</title>
	<link rel="stylesheet" href="/css/style.css">
	
      <link rel="alternate" href="/atom.xml" title="Von Weber&#39;s Blog" type="application/atom+xml">
	
	
	<script type="text/x-mathjax-config">
		MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
	</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML" async></script>

	
		<!-- Highlight.js -->
		<link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css">
		<script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js">
		</script>
		<script> hljs.initHighlightingOnLoad();
		</script>
	

</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/archives" class="header__link">Archive</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Von Weber&#39;s Blog</a></h1>
		<h2 class="header__subtitle"></h2>
	</header>

	<main>
		



	<article>
	
		<h1><a href="/2018/11/03/SIMDæŒ‡ä»¤ä¼˜åŒ–/">SIMDæŒ‡ä»¤ä¼˜åŒ–</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2018-11-03</span><br>
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/AVX2/">AVX2</a> <a class="article__tag-link" href="/tags/C/">C</a> <a class="article__tag-link" href="/tags/SIMD/">SIMD</a> <a class="article__tag-link" href="/tags/æ±‡ç¼–/">æ±‡ç¼–</a>
			</span>
		
	</div>

	

	
		<p>æœ¬æ–‡ä»‹ç»åˆ©ç”¨SIMDæŒ‡ä»¤ï¼ˆAVX2ï¼‰ä¼˜åŒ–è¿ç®—çš„ä¸€ç‚¹æ¢ç´¢ï¼Œä»¥å•ç²¾åº¦floatç±»å‹çš„åŠ æ³•å’Œä¹˜æ³•ä¸ºä¾‹ã€‚</p>
<p>è®¡ç®—æ¨¡å‹ï¼š</p>
<ul>
<li>hardware: E5 2678 v3 2.5GHz; X99; DDR4 2133 MHz 16GB x1</li>
<li>software: win10 17134; mingw-W64(gcc) 8.1.0</li>
</ul>
<h2 id="SIMDå’ŒAVX2ç®€ä»‹"><a href="#SIMDå’ŒAVX2ç®€ä»‹" class="headerlink" title="SIMDå’ŒAVX2ç®€ä»‹"></a>SIMDå’ŒAVX2ç®€ä»‹</h2><p>SIMD (<strong>s</strong>ingle <strong>i</strong>nstrucion <strong>m</strong>ultiple <strong>d</strong>ata)å•æŒ‡ä»¤å¤šæ•°æ®æ˜¯ç”¨æ¥å¯¹å¤šä¸ªæ•°æ®æ‰§è¡Œå•ä¸ªæŒ‡ä»¤ï¼ˆç®—æœ¯æˆ–é€»è¾‘ï¼‰çš„å‘é‡åŒ–æ–¹æ³•ï¼Œæ˜¯X86-64(AMD64)æŒ‡ä»¤é›†çš„æ‹“å±•ã€‚ç”±æœ€æ—©çš„SSEï¼ˆSSEæœ‰å¤šä¸ªæ”¹è¿›ç‰ˆæœ¬ï¼Œæœ€åçš„SSEç‰ˆæœ¬æ˜¯SSE4.2ï¼‰ï¼Œåˆ°åæ¥çš„AVXï¼ŒAVX2ï¼Œæœ€æ–°çš„æ˜¯AVX512ï¼Œç”±äºAVX512åœ¨è¾ƒæ–°å’Œé«˜ç«¯çš„CPUæ‰æ”¯æŒï¼Œç›¸è¾ƒè€Œè¨€ï¼Œæ›´å¤šçš„CPUæ”¯æŒAVX2ã€‚</p>
<p>AVX2æŒ‡ä»¤é›†é…åˆ16ä¸ª256ä½ymmå¯„å­˜å™¨ï¼ˆä½128ä½ä¸ºxmmå¯„å­˜å™¨ï¼‰ï¼Œå¯ä»¥å­˜å‚¨8ä¸ª4å­—èŠ‚(float, int)æˆ–4ä¸ª8å­—èŠ‚(double, long)æ•°æ®ï¼Œå¹¶åœ¨ä¸€ä¸ªæŒ‡ä»¤å†…åŒæ—¶åš8ä¸ªæˆ–4ä¸ªè¿ç®—ã€‚</p>
<h2 id="Naive-Solution"><a href="#Naive-Solution" class="headerlink" title="Naive Solution"></a>Naive Solution</h2><p>ç°åœ¨æ¥è€ƒè™‘ä¸€ä¸ªä»»åŠ¡ï¼Œå°†é•¿åº¦å‡ä¸º<code>N = 100000</code>çš„floatæ•°ç»„<code>a, b, c</code>åšè¿ç®—<code>(a + b) * c</code>ï¼Œå­˜æ”¾åœ¨æ•°ç»„cä¸­ã€‚å°†è¿™ä¸ªæ“ä½œé‡å¤<code>NTIME = 50000</code>æ¬¡ï¼Œè®°å½•æ¶ˆè€—çš„æ—¶é—´ã€‚</p>
<p>ç”±äºè¿™ä¸ªä»»åŠ¡ä½œä¸ºç¼–ç¨‹é—®é¢˜æ˜¯å¦‚æ­¤çš„ç®€å•å’Œç›´æ¥ï¼Œæˆ‘ä»¬å¾ˆå¿«å†™å‡ºcç¨‹åºå¦‚<code>code 0: simd0.c</code>ï¼Œå¹¶è§‰å¾—æ¯«æ— ä¼˜åŒ–çš„ä½™åœ°ï¼Œå› ä¸ºä»…æœ‰ä¸‰è¡Œä»£ç æ²¡æœ‰ä»»ä½•å¤šä½™çš„æ“ä½œï¼Œåªæœ‰17,19,20ä¸‰è¡Œä»£ç æ˜¯åœ¨å®Œæˆä»»åŠ¡ã€‚å…¶ä¸­çš„å˜é‡<code>sum</code>ä»…ä»…æ˜¯ç”¨æ¥é˜²æ­¢ç¼–è¯‘å™¨çš„è‡ªåŠ¨ä¼˜åŒ–ä¼šç›´æ¥å»æ‰é‡å¤50000æ¬¡è¿™ä¸ªæ­¥éª¤ï¼Œè™½ç„¶è¿™ä¸ªä¼˜åŒ–å¾ˆå‰å®³ï¼Œä½†æ˜¯åç¦»äº†æˆ‘ä»¬çš„åŸæ„ã€‚</p>
<p>ä½¿ç”¨å‘½ä»¤<code>gcc simd0.c -o simd0.exe</code>ç¼–è¯‘ï¼Œè¿è¡Œæ—¶é—´ä¸º<code>13s 803ms 846Î¼s</code>ï¼Œå–5æ¬¡è®¡ç®—çš„ä¸­ä½æ•°ï¼Œä¸‹åŒã€‚å¦‚æœæˆ‘ä»¬æ»¡è¶³äºè¿™ä¸ªç»“æœï¼Œè§‰å¾—å·²ç»å¾ˆå¿«äº†ï¼Œé‚£ç”Ÿæ´»ä¹Ÿå°±æ²¡æœ‰äº†ä¹è¶£ã€‚</p>
<p><code>`</code>c code 0: simd0.c</p>
<p>#include &lt;sys/time.h&gt;</p>
<p>#include &lt;stdio.h&gt;</p>
<p>#define N 100000</p>
<p>#define NTIMES 50000</p>
<p>float a[N], b[N], c[N], r[N];</p>
<p>int main(void)<br>{<br>    int i, times, sum;<br>    struct timeval starttime, endtime;<br>    long s, ms, us, timeuse;<br>    gettimeofday(&amp;starttime, 0);</p>
<pre><code>/* workhorse code  */
for (times = 0; times &lt; NTIMES; times++)
{
    for (i = 0; i &lt; N; ++i)
        r[i] = (a[i] + b[i]) * c[i];
    sum += sum;
}

/* elapsed time  */
gettimeofday(&amp;endtime, 0);
timeuse = 1000000 * (endtime.tv_sec - starttime.tv_sec) + 
        endtime.tv_usec - starttime.tv_usec;
s = timeuse / 1000000;
ms = timeuse / 1000 % 1000;
us = timeuse % 1000;
printf(&quot;%ld s %ld ms %ld us\n&quot;, s, ms, us);

return sum;
</code></pre><p>}</p>
<pre><code>## GCCè‡ªåŠ¨ä¼˜åŒ–
æˆ‘ä»¬å¯ä»¥ç”¨å‘½ä»¤`gcc -S -o simd0.s simd0.c`ç”Ÿæˆä¸Šè¿°ç¨‹åº`simd0.exe`çš„æ±‡ç¼–ä»£ç ï¼Œçœ‹çœ‹å“ªé‡Œå¯ä»¥ä¼˜åŒ–ï¼Œå…¶å®è¿™ä¸ªæ±‡ç¼–çš„è ¢ä¸åœ¨äºæ²¡æœ‰ç”¨SIMDæŒ‡ä»¤ï¼Œä¸»è¦é—®é¢˜æ˜¯æœ‰å¤ªå¤šçš„è®¿é—®å†…å­˜æŒ‡ä»¤ï¼Œä»£ç æ²¡æœ‰è´´å‡ºæ¥ã€‚

å¦‚æœæˆ‘ä»¬ä½¿ç”¨`-O1`å‚æ•°è¿›è¡Œä¼˜åŒ–ï¼Œå³`gcc -O1 -o simd0-O1.exe simd0.c`ï¼Œæ¶ˆè€—çš„æ—¶é—´ä¸‹é™ä¸º`3s 841ms 346Î¼s`ã€‚æ±‡ç¼–ä»£ç å¦‚`code 1: simd0-O1.s`, å…¶ä¸­ç•¥å»äº†è®¡æ—¶ï¼Œæ‰“å°å’ŒæŸäº›ä¼ªæŒ‡ä»¤ï¼Œä¸‹åŒã€‚
```x86asm code 1: simd0-O1.s
main:
  movl $50000, %edx
  jmp .L2
.L6:
  addss %xmm1, %xmm1
  subl $1, %edx
  je .L4
.L2:
  movl $0, %eax
.L3:
  movss a(%rax), %xmm0
  addss b(%rax), %xmm0
  mulss c(%rax), %xmm0
  movss %xmm0, r(%rax)
  addq $4, %rax
  cmpq $400000, %rax
  jne .L3
  jmp .L6
.L4:
  cvttss2si %xmm1, %eax
  ret
</code></pre><p><code>simd0-O1.s</code>çš„ä»£ç å’Œä¸ä½¿ç”¨ä¼˜åŒ–çš„ä»£ç ç›¸æ¯”ï¼Œä¸»è¦æ”¹è¿›æ˜¯ä»å†…å­˜ä¸­å–ä¸€ä¸ªæ•°æ¯”å¦‚<code>a[i]</code>ï¼Œåªéœ€è¦ä¸€æ¬¡è®¿å­˜ï¼Œå› ä¸ºæŒ‡æ ‡<code>i</code>å­˜åœ¨å¯„å­˜å™¨<code>%rax</code>ä¸­ï¼Œè¿™ä¸€ä¸ªæ”¹è¿›å¤§å¹…é™ä½äº†è®¿é—®æŒ‡æ ‡<code>i</code>å’Œæ•°ç»„å…ƒç´ <code>a[i]</code>å’Œå…¶ä»–æ•°ç»„çš„æ—¶é—´ã€‚<code>simd0-O1.s</code>çš„ä»£ç éå¸¸ç¬¦åˆæˆ‘ä»¬æ€ç»´ï¼Œå®ƒä½¿ç”¨<code>movss</code>ä»å†…å­˜ä¸­å–ä¸€ä¸ªå•ç²¾åº¦æ•°ï¼Œä½¿ç”¨<code>addss</code>å’Œ<code>mulss</code>æ‰§è¡Œå•ç²¾åº¦æµ®ç‚¹æ•°çš„åŠ æ³•å’Œä¹˜æ³•ã€‚æ‰§è¡Œä¸€éè®¡ç®—åå†åšç¬¬äºŒéã€‚</p>
<p>ä½¿ç”¨<code>-O2</code>ä¼˜åŒ–å’Œ<code>-O1</code>å¯¹è¿™ä¸ªç¨‹åºæ²¡æœ‰å¤ªå¤§å·®å¼‚ï¼Œæˆ‘ä»¬ç•¥å»ã€‚</p>
<h2 id="SIMDçš„ç¬¬ä¸€å°è¯•"><a href="#SIMDçš„ç¬¬ä¸€å°è¯•" class="headerlink" title="SIMDçš„ç¬¬ä¸€å°è¯•"></a>SIMDçš„ç¬¬ä¸€å°è¯•</h2><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨<code>-O3</code>çº§åˆ«ä¼˜åŒ–ï¼Œå°±ä¼šæ”¾å‘ç”ŸæŸäº›ä¸ä¸€æ ·çš„äº‹æƒ…ï¼Œæ±‡ç¼–ä»£ç è§<code>code 2: simd0-O3.s</code><br><code>`</code>x86asm code 2: simd0-O3.s<br>main:<br>  movl $50000, %edx<br>.L2:<br>  xorl %eax, %eax<br>.L3:<br>  movaps b(%rax), %xmm0<br>  addps a(%rax), %xmm0<br>  addq $16, %rax<br>  mulps c-16(%rax), %xmm0<br>  movaps %xmm0, r-16(%rax)<br>  cmpq $400000, %rax<br>  jne .L3<br>  addss %xmm1, %xmm1<br>  subl $1, %edx<br>  jne .L2<br>  cvttss2si %xmm1, %eax<br>  ret</p>
<pre><code>å’Œ`code 1: simd0-O2.s`ç›¸æ¯”ï¼Œ`code 2: simd0-O3.s`ä»£ç å¯ç”¨äº†SSEæŒ‡ä»¤é›†çš„SIMDæŒ‡ä»¤ï¼Œå®ƒä½¿ç”¨å®Œæ•´çš„`xmm`å¯„å­˜å™¨ï¼Œè€Œä¸æ˜¯ä½32ä½ï¼Œè¿›è¡Œæµ®ç‚¹æ•°çš„åŠ æ³•å’Œä¹˜æ³•ã€‚å…¶ä¸­ï¼Œ`movaps`ä»å†…å­˜ä¸­å–4ä¸ªå•ç²¾åº¦æµ®ç‚¹æ•°æ”¾åœ¨`xmm`å¯„å­˜å™¨ä¸­ï¼Œæˆ–è€…ç›¸åæ–¹å‘ï¼Œ`addps`å’Œ`mulps`åˆ†åˆ«å¯¹`xmm`å¯„å­˜å™¨ä¸­çš„4ä¸ªå•ç²¾åº¦æ•°æ®åšåŠ æ³•å’Œä¹˜æ³•ã€‚ä½¿ç”¨SSEæŒ‡ä»¤ï¼Œè¿è¡Œæ—¶é—´åˆé™ä¸º`2s 612ms 38Î¼s`ã€‚

## AVX2ä¸Šåœº
è™½ç„¶æˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨å‚æ•°è®©ç¼–è¯‘å™¨è‡ªåŠ¨å‘é‡åŒ–ï¼Œæ¯”å¦‚`gcc -O3 -maxv2 -o simd1-avx2-O3.exe simd1.c`ï¼Œä½†æ˜¯è¿™æ ·çš„ä¼˜åŒ–ç»“æœæ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå› æ­¤åœ¨ç¼–ç¨‹çš„æ—¶å€™ä½¿ç”¨é€‚å½“çš„æœºåˆ¶æˆ–çº¦å®šå¼•å¯¼ç¼–è¯‘å™¨è¿›è¡Œå‘é‡åŒ–ï¼Œæ˜¯æ›´åŠ ç¨³å¥çš„æ–¹æ³•ã€‚

### å†…å­˜å¯¹é½
å°†å˜é‡çš„å­˜å‚¨åœ°å€å¯¹é½åˆ°8/16/32/64ç­‰æ•´æ•°çš„å€æ•°ï¼Œæ˜¯æŸäº›æŒ‡ä»¤çš„è¦æ±‚ï¼ŒåŒæ—¶å¯ä»¥ä½¿å¯»å€æ›´åŠ æœ‰æ•ˆã€‚åœ¨GCCç¯å¢ƒä¸‹ï¼Œä½¿ç”¨`__attribute__((aligned(__BIGGEST_ALIGNMENT__)))`ä¿®é¥°ç¬¦å¼•å¯¼ç¼–è¯‘å™¨è¿›è¡Œå†…å­˜å¯¹é½ã€‚æ¯”å¦‚å£°æ˜é•¿åº¦ä¸ºNçš„floatæ•°ç»„ï¼Œå¯¹é½åˆ°64å­—èŠ‚
```c 
float a[N] __attribute__((aligned(64)));
</code></pre><h3 id="å‘é‡æ•°æ®ç±»å‹"><a href="#å‘é‡æ•°æ®ç±»å‹" class="headerlink" title="å‘é‡æ•°æ®ç±»å‹"></a>å‘é‡æ•°æ®ç±»å‹</h3><p>åœ¨GCCç¯å¢ƒä¸‹ï¼Œå¯ä»¥å£°æ˜åŸºæœ¬æ•°æ®ç±»å‹<code>char int float double long</code>çš„æ•°ç»„ä½œä¸ºå‘é‡ï¼Œæ¥å¼•å¯¼ç¼–è¯‘å™¨ä½¿ç”¨SIMDæŒ‡ä»¤ç¼–è¯‘ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç å£°æ˜äº†ä¸€ç§8ä¸ªfloaté•¿çš„å‘é‡ç±»å‹<code>v8f</code>ï¼Œ</p>
<pre><code class="c">typedef float v8f __attribute__((vector_size(32)));
</code></pre>
<p>å‘é‡æ•°æ®ç±»å‹å¯ä»¥ä½¿ç”¨è¿ç®—ç¬¦<code>+ - * / &amp; ^ | %</code>ç­‰è¿›è¡Œé€å…ƒç´ è¿ç®—ï¼Œä»–ä»¬ä¼šè¢«ç¼–è¯‘æˆç›¸åº”çš„SIMDæŒ‡ä»¤ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸Šé¢çš„æŠ€å·§ï¼Œæ¥é‡å†™ç¨‹åºï¼Œç¡®ä¿æˆ‘ä»¬ä½¿ç”¨äº†SIMDæŒ‡ä»¤ï¼Œè§<code>code 3: simd1.c</code><br><code>`</code>c code 3: simd1.c</p>
<p>#include &lt;sys/time.h&gt;</p>
<p>#include &lt;stdio.h&gt;</p>
<p>#define N 100000</p>
<p>#define NTIMES 50000</p>
<p>#define ALIGN 64<br>typedef float v8f <strong>attribute</strong>((vector_size(32)));</p>
<p>#define VLEN (sizeof(v8f) / sizeof(float))</p>
<p>float a[N] <strong>attribute</strong>((aligned(ALIGN)));<br>float b[N] <strong>attribute</strong>((aligned(ALIGN)));<br>float c[N] <strong>attribute</strong>((aligned(ALIGN)));<br>float r[N] <strong>attribute</strong>((aligned(ALIGN)));</p>
<p>int main(void)<br>{<br>    v8f <em>va, </em>vb, <em>vc, </em>vr;<br>    int i, times, sum;<br>    struct timeval starttime, endtime;<br>    long s, ms, us, timeuse;<br>    gettimeofday(&amp;starttime, 0);</p>
<pre><code>/* workhorse code  */
for (times = 0; times &lt; NTIMES; times++)
{
    va = (v8f *)a;
    vb = (v8f *)b;
    vc = (v8f *)c;
    vr = (v8f *)r;
    for (i = 0; i &lt; N; i += VLEN){
        *vr = (*va + *vb) * (*vc);
        va++, vb++, vc++, vr++;
    }
    sum += sum;
}

/* elapsed time  */
gettimeofday(&amp;endtime, 0);
timeuse = 1000000 * (endtime.tv_sec - starttime.tv_sec) + 
endtime.tv_usec - starttime.tv_usec;
s = timeuse / 1000000;
ms = timeuse / 1000 % 1000;
us = timeuse % 1000;
printf(&quot;%ld s %ld ms %ld us\n&quot;, s, ms, us);

return sum;
</code></pre><p>}</p>
<pre><code>ä¸Šé¢çš„ç¨‹åºä½¿ç”¨æŒ‡å‘å‘é‡æ•°æ®ç±»å‹`v8f`çš„æŒ‡é’ˆæ¥è¿›è¡Œè¿ç®—ï¼Œè¿™äº›æ“ä½œå¯ä»¥å¾ˆå¥½çš„ç¼–è¯‘æˆSIMDæŒ‡ä»¤ã€‚å¹¶ä¸”ç”±äºå‘é‡é•¿åº¦æ˜¯8çš„æ•´æ•°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ç”¨é¢å¤–çš„æ“ä½œã€‚ä½¿ç”¨å‘½ä»¤`gcc -mavx2 -O3 -S -o simd1-O3.s simd1.c`ç¼–è¯‘ï¼Œå¾—åˆ°å’Œæˆ‘ä»¬é¢„æƒ³ä¸€æ ·çš„æ±‡ç¼–ä»£ç 
```x86asm code 4: simd1-O3.s
main:
  xorl %eax, %eax
  movl $50000, %ecx
.L3:
  xorl %edx, %edx
.L2:
  vmovaps a(%rdx), %ymm1
  vaddps b(%rdx), %ymm1, %ymm0
  addq $32, %rdx
  vmulps c-32(%rdx), %ymm0, %ymm0
  vmovaps %ymm0, r-32(%rdx)
  cmpq $400000, %rdx
  jne .L2
  addl %eax, %eax
  subl $1, %ecx
  jne .L3
  vzeroupper
  ret
</code></pre><p>å’Œ<code>code 2: simd0-O3.s</code>ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œä½¿ç”¨æŒ‡ä»¤<code>vmovaps vaddps vmulps</code>å¯¹8ä¸ªï¼ˆç»„ï¼‰floatæ•°æ®è¿›è¡Œæ“ä½œã€‚è™½ç„¶æˆ‘ä»¬ä¸€é¡¿æ“ä½œï¼Œä½†æ˜¯æ•ˆç‡æå‡å¹¶ä¸æ˜æ˜¾ï¼ŒåŸå› æ˜¯å› ä¸ºè¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ€è´¹æ—¶çš„æ˜¯å†…å­˜çš„è¯»å†™è€Œä¸æ˜¯è®¡ç®—åŠ æ³•å’Œä¹˜æ³•ã€‚</p>
<p>æˆ‘ä»¬æ¢ä¸€ä¸ªé¡ºåºï¼Œå¯¹äºæŸä¸ªiï¼Œæˆ‘ä»¬é‡å¤<code>NTIMES</code>æ¬¡<code>r[i] = (a[i] + b[i]) * c[i]</code>æ“ä½œï¼Œç„¶ååœ¨è¿›è¡Œä¸‹ä¸€ä¸ªiï¼Œç”±äºç¼–è¯‘å™¨ä¼˜åŒ–æ€»æ˜¯ä¼šå»æ‰ä¸€å±‚å¾ªç¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä¿®æ”¹æ±‡ç¼–ä»£ç å¦‚ä¸‹<br><code>`</code>x86asm code 5: simd2-0.s<br>main:<br>.L2:<br>    movl    $50000, %eax<br>.L3:<br>    vmovaps    a(%rdx), %ymm1<br>    vaddps    b(%rdx), %ymm1, %ymm0<br>    vmulps    c(%rdx), %ymm0, %ymm0<br>    .p2align 4,,10<br>    addl    %ebx, %ebx<br>    vmovaps    %ymm0, r(%rdx)<br>    subl    $1, %eax<br>    jne    .L3<br>    addq    $32, %rdx<br>    cmpq    $400000, %rdx<br>    jne    .L2<br>    xorl    %edx, %edx<br>    vzeroupper<br>    ret</p>
<pre><code>
ç”¨å‘½ä»¤`gcc -o simd2-0.exe simd2-0.s`å°†æ±‡ç¼–æŒ‡ä»¤é“¾æ¥æˆäºŒè¿›åˆ¶ç¨‹åºã€‚è™½ç„¶åªæ˜¯è°ƒæ¢äº†ä¸¤ä¸ªå¾ªç¯çš„é¡ºåºï¼Œæ“ä½œä¹Ÿæ²¡æœ‰å°‘ä¸€ä¸ªï¼Œä½†æ˜¯ç”±äºL1/2/3 cacheçš„å­˜åœ¨ï¼Œ`code 5`aæ˜¾è‘—é™ä½äº†è®¿é—®å†…å­˜çš„æ¬¡æ•°ï¼Œæ‰§è¡Œæ—¶é—´ä»…ä¸º`0s 634ms 562Î¼s`ï¼ŒéªŒè¯äº†æˆ‘ä»¬ä¸Šé¢å…³äºæ•ˆç‡ç“¶é¢ˆçš„è®ºæ–­ã€‚

å¦‚æœæˆ‘ä»¬æ˜¾å¼åœ°å…ˆè¯»ä¸€æ¬¡æ•°æ®åˆ°å¯„å­˜å™¨ä¸­ï¼Œåš`NTIMES`æ¬¡è®¡ç®—ï¼Œæœ€åå†å†™åˆ°å†…å­˜ä¸­ï¼Œè¿™æ ·å°±é¿å…äº†å¤šæ¬¡è¯»å†™å†…å­˜çš„æ“ä½œã€‚æ±‡ç¼–ä»£ç å¦‚ä¸‹
```x86asm code 6: simd2-1.s
main:
.L2:
    movl    $50000, %eax
    vmovaps    a(%rdx), %ymm1
    vmovaps    b(%rdx), %ymm2
    vmovaps    c(%rdx), %ymm3
.L3:
    vaddps    %ymm2, %ymm1, %ymm0
    vmulps    %ymm3, %ymm0, %ymm0
    .p2align 4,,10
    addl    %ebx, %ebx
    vmovaps    %ymm0, r(%rdx)
    subl    $1, %eax
    jne    .L3
    addq    $32, %rdx
    cmpq    $400000, %rdx
    jne    .L2
    xorl    %edx, %edx
    vzeroupper
    ret
</code></pre><p>æœ€åä¼˜åŒ–çš„ç¨‹åºæ‰§è¡Œæ—¶é—´ä¸º<code>0s 324ms 504Î¼s</code>ã€‚å’Œæœ€åˆçš„13.8sç›¸æ¯”ï¼Œè¿™ä¸ªé€Ÿåº¦å¿«äº†40å¤šå€ï¼Œè™½ç„¶ä¸»è¦åŠŸåŠ³å¹¶ä¸å½’åŠŸäºSIMDæŒ‡ä»¤ï¼Œä½†æ˜¯åˆç†çš„SIMDå‘é‡åŒ–æœ‰åŠ©äºæˆ‘ä»¬å‡å°‘å†…å­˜çš„è®¿é—®ï¼Œä»è€Œä¸ºç¨‹åºåŠ é€Ÿã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2018/11/02/Hexoæµ‹è¯•/">Hexo Blog Test</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2018-11-02</span><br>
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/test/">test</a>
			</span>
		
	</div>

	

	
		<h1 id="1çº§æ ‡é¢˜-title"><a href="#1çº§æ ‡é¢˜-title" class="headerlink" title="1çº§æ ‡é¢˜ title"></a>1çº§æ ‡é¢˜ title</h1><h2 id="2çº§æ ‡é¢˜"><a href="#2çº§æ ‡é¢˜" class="headerlink" title="2çº§æ ‡é¢˜"></a>2çº§æ ‡é¢˜</h2><h3 id="3çº§æ ‡é¢˜"><a href="#3çº§æ ‡é¢˜" class="headerlink" title="3çº§æ ‡é¢˜"></a>3çº§æ ‡é¢˜</h3><p>æ­£æ–‡ï¼Œå­—ä½“ã€‚</p>
<p>ä»£ç æ ·å¼ï¼Œå¼•ç”¨<code>vmulpd</code>å’Œ<code>æŒ‡ä»¤é›†</code>ã€‚<em>å¼ºè°ƒ</em>å’Œ<strong>å¼ºè°ƒ</strong><br><code>`</code> c vsum.c<br>float vsum(float *v, int n)<br>{<br>    float s = 0.0; int i;<br>    for (i=0; i&lt;n; i++)<br>    s += v[i];<br>    return s;<br>}</p>
<pre><code>MathJax test.
When \\(a \ne 0\\), there are two solutions to $ax^2 + bx + c = 0$ and they are
inline symbols, $\LaTeX \And \alpha$ and 
  $$x = {-b \pm \sqrt{b^2-4ac} \over 2a}.$$

```html add MathJax support
&lt;script type=&quot;text/x-mathjax-config&quot;&gt;
  MathJax.Hub.Config({tex2jax: {inlineMath: [[&#39;$&#39;,&#39;$&#39;], [&#39;\\(&#39;,&#39;\\)&#39;]]}});
&lt;/script&gt;
&lt;script src=&#39;https://cdnjs.cloudflare.com/ajax/libs/
mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML&#39; async&gt;&lt;/script&gt;
</code></pre>
	

	

</article>




	<article>
	
		<h1><a href="/2018/11/02/hello-world/">Hello World</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2018-11-02</span><br>
		
		
	</div>

	

	
		<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre><code class="bash">$ hexo new &quot;My New Post&quot;
</code></pre>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre><code class="bash">$ hexo server
</code></pre>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre><code class="bash">$ hexo generate
</code></pre>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre><code class="bash">$ hexo deploy
</code></pre>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

	

	

</article>






	<span class="different-posts">ğŸ“• end of posts ğŸ“•</span>


	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<p>Hi there, <br>welcome to my Blog glad you found it. Have a look around, will you?</p>
</div>

	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2018 von Weber | Powered by <a href="https://hexo.io/">Hexo</a> | Theme <a href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a></span>
		</div>

	</div>


</footer>



</body>

</html>
